{"version":3,"sources":["../../src/result_transformer.js"],"names":["transformDataToTable","analyticsResult","options","datapoints","_","map","rows","row","target","resultTarget","transformDataToTimeSeries","groupBys","data","groupBy","results","length","groupings","metricLabel","push","Object","keys","key","series","orderBy","result","transform","response","config","resultFormat","ResultFormat","TABLE","TIME_SERIES"],"mappings":";;;;;;;AAAA;;AAEA,IAAMA,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,eAAD,EAAkBC,OAAlB,EAA8B;AACzD,MAAIC,UAAU,GAAGC,CAAC,CAACC,GAAF,CAAMJ,eAAe,CAACK,IAAtB,EAA4B,UAAAC,GAAG,EAAI;AAClD,WAAO,CAACA,GAAG,CAAC,CAAD,CAAJ,EAASA,GAAG,CAAC,CAAD,CAAZ,CAAP,CADkD,CACzB;AAC1B,GAFgB,CAAjB;;AAIA,SAAO;AACLC,IAAAA,MAAM,EAAEN,OAAO,CAACO,YADX;AAELN,IAAAA,UAAU,EAAEA;AAFP,GAAP;AAID,CATD;;AAWA,IAAMO,yBAAyB,GAAG,SAA5BA,yBAA4B,CAACT,eAAD,EAAkBC,OAAlB,EAA8B;AAC9D,MAAMS,QAAQ,GAAGT,OAAO,CAACU,IAAR,CAAaC,OAA9B;AACA,MAAMC,OAAO,GAAG,EAAhB;;AACA,MAAIH,QAAQ,CAACI,MAAT,GAAkB,CAAtB,EAAyB;AACvB,QAAIC,SAAS,GAAG,EAAhB;;AACAZ,IAAAA,CAAC,CAACC,GAAF,CAAMJ,eAAe,CAACK,IAAtB,EAA4B,UAAAC,GAAG,EAAI;AACjC,UAAMU,WAAW,GAAGV,GAAG,CAAC,CAAD,CAAvB;;AACA,UAAI,CAACS,SAAS,CAACC,WAAD,CAAd,EAA6B;AAC3BD,QAAAA,SAAS,CAACC,WAAD,CAAT,GAAyB,EAAzB;AACD;;AACDD,MAAAA,SAAS,CAACC,WAAD,CAAT,CAAuBC,IAAvB,CAA4B,CAACX,GAAG,CAAC,CAAD,CAAJ,EAASA,GAAG,CAAC,CAAD,CAAZ,CAA5B,EALiC,CAKc;AAChD,KAND;;AAOAY,IAAAA,MAAM,CAACC,IAAP,CAAYJ,SAAZ,EAAuBX,GAAvB,CAA2B,UAAAgB,GAAG,EAAI;AAChC,UAAMlB,UAAU,GAAGa,SAAS,CAACK,GAAD,CAA5B;AACA,UAAMC,MAAM,GAAG;AACbd,QAAAA,MAAM,EAAEa,GADK;AAEblB,QAAAA,UAAU,EAAEC,CAAC,CAACmB,OAAF,CAAUpB,UAAV,EAAsB,CAAC,CAAD,CAAtB,EAA2B,KAA3B;AAFC,OAAf;AAIAW,MAAAA,OAAO,CAACI,IAAR,CAAaI,MAAb;AACD,KAPD;AAQD,GAjBD,MAiBO;AACL,QAAIE,MAAM,GAAIxB,oBAAoB,CAACC,eAAD,EAAkBC,OAAlB,CAAlC;AACAsB,IAAAA,MAAM,CAACrB,UAAP,GAAoBC,CAAC,CAACmB,OAAF,CAAUC,MAAM,CAACrB,UAAjB,EAA6B,CAAC,CAAD,CAA7B,EAAkC,KAAlC,CAApB;AACAW,IAAAA,OAAO,CAACI,IAAR,CAAaM,MAAb;AACD;;AACD,SAAOV,OAAP;AACD,CA1BD;;AA4BO,IAAMW,SAAS,GAAG,SAAZA,SAAY,CAACC,QAAD,EAAWxB,OAAX,EAAuB;AAC9C,MAAMD,eAAe,GAAGyB,QAAQ,CAACd,IAAT,CAAcA,IAAd,CAAmBY,MAA3C;AACA,MAAMG,MAAM,GAAGD,QAAQ,CAACC,MAAxB;;AACA,MAAIA,MAAM,CAACC,YAAP,KAAwBC,2BAAaC,KAAzC,EAAgD;AAC9C,WAAO,CAAC9B,oBAAoB,CAACC,eAAD,EAAkB0B,MAAlB,CAArB,CAAP;AACD,GAFD,MAEO,IAAIA,MAAM,CAACC,YAAP,KAAwBC,2BAAaE,WAAzC,EAAsD;AAC3D,WAAOrB,yBAAyB,CAACT,eAAD,EAAkB0B,MAAlB,CAAhC;AACD;AACF,CARM","sourcesContent":["import {ResultFormat} from './types/resultFormat';\n\nconst transformDataToTable = (analyticsResult, options) => {\n  let datapoints = _.map(analyticsResult.rows, row => {\n    return [row[1], row[0]]; // value, timestamp\n  });\n\n  return {\n    target: options.resultTarget,\n    datapoints: datapoints\n  }\n}\n\nconst transformDataToTimeSeries = (analyticsResult, options) => {\n  const groupBys = options.data.groupBy;\n  const results = [];\n  if (groupBys.length > 0) {\n    let groupings = {};\n    _.map(analyticsResult.rows, row => {\n      const metricLabel = row[1];\n      if (!groupings[metricLabel]) {\n        groupings[metricLabel] = [];\n      }\n      groupings[metricLabel].push([row[2], row[0]]); // value, timestamp\n    });\n    Object.keys(groupings).map(key => {\n      const datapoints = groupings[key];\n      const series = {\n        target: key,\n        datapoints: _.orderBy(datapoints, [1], 'asc')\n      }\n      results.push(series);\n    });\n  } else {\n    let result =  transformDataToTable(analyticsResult, options);\n    result.datapoints = _.orderBy(result.datapoints, [1], 'asc');\n    results.push(result);\n  }\n  return results;\n}\n\nexport const transform = (response, options) => {\n  const analyticsResult = response.data.data.result;\n  const config = response.config;\n  if (config.resultFormat === ResultFormat.TABLE) {\n    return [transformDataToTable(analyticsResult, config)];\n  } else if (config.resultFormat === ResultFormat.TIME_SERIES) {\n    return transformDataToTimeSeries(analyticsResult, config);\n  }\n}\n"],"file":"result_transformer.js"}